<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ukukhula Admin Dashboard</title>
    <link rel="stylesheet" href="../css/admin.css" />
    <link rel="stylesheet" href="../css/student-form-styles.css">
    <link rel="stylesheet" href="../css/classes.css"/>
    <script defer src="../js/fetch_data.js"></script>
    <script defer src="../js/admin.js"></script>
    <script src="../js/university_allocation.js"></script>
    <script src="../js/university_application.js"></script>
    <script src="../js/fetch_data.js"></script>
    <script src="../js/add_option_values.js"></script>
    <script src="../js/requests.js"></script>
    <script src="../js/display_admin_balance.js"></script>
    <!-- <script src="../js/manage_page_sections.js"></script> -->
    
</head>
<body>
    <header>
        <nav>
          <a href="#student-applications" class="other-link"> Student Applications</a>
          <a href="#university_application" class="other-link">University Applications</a>
          <a href="#university-allocations" class="other-link"> University Allocations</a>
          <a href="#requests" class="other-link"> Requests</a>
          
        </nav>
      </header>
      <main style="height: auto;">

<section id = "requests">

  <button id="add-admin-button">Add admin</button>
<article>
  <h2>Add a New Admin</h2>
  <form id="hodForm">
    First Name: <input type="text" id="firstName" name = firstName><br>
    Last Name: <input type="text" id="lastName" name="lastName"><br>
    Phone Number: <input type="text" id="phoneNumber" name="phoneNumber"><br>
    Email: <input type="email" id="email" name="email"><br>
    Department: <input type="text" id="department" name="department"><br>
    University Name: <input type="text" id="universityName" name="universityName"><br>
    <input type = "submit"/>
</form>
</article>






  <article  id="add-admin-section" class="add-admin">
    <form class="add-admin-form" method="post">
        <label for="admin-firstname">First Name</label>
        <input type="text" id="admin-firstname" name="adminFirstName" required>

        <label for="admin-lastname">Last Name</label>
        <input type="text" id="admin-lastname" name="adminLastName" required>

        <label for="admin-number">Phone Number</label>
        <input type="text" id="admin-number" name="adminFirstName" pattern="^(\+27|0)[6-8][0-9]{8}$" required>

        <label for="admin-email">Email</label>
        <input type="email" id="admin-email" name="adminEmail">

        <button class="submit-add-admin" type="submit">Submit</button>
    </form>
</article>


<table id="data-table">
  <thead>
      <tr>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Phone Number</th>
          <th>Email</th>
          <th>Department</th>
          <th>University Name</th>
          <th>Actions</th>
      </tr>
  </thead>
  <tbody id="requests-table-body">
  </tbody>
</table>
</section>

</section>

        <section id="student-applications" class="student-applications-table">
            <h1>Student Applications </h1>
            <table>
                <thead>
                <tr>
                    <th >FullName</th>
                    <th class="hide-mobile">UniversityName</th>
                    <th class="hide-mobile">BursaryAmount</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="table-body">
                </tbody>
            </table>

            <section class="pop-up-card">
                <article class="pop-up-content">
                  <img src="../css/images/cross.png" alt="cancel" class="cancel">
                  <h2>Student Details</h2>
              
                  <article class="application-info">
                    <p class="description">ApplicationId: <span class="student-applicationID"></span></p>
                    <p class="description">Student Name: <span class="student-name"></span></p>
                    <p class="description">IdNumber: <span class="student-id-number"></span></p>
                    <p class="description">Sex: <span class="student-sex"></span></p> 
                    <p class="description">Ethnicity: <span class="student-ethnicity"></span></p>
                    <p class="description">Email: <span class="student-email"></span></p>
                    <p class="description">Phone Number: <span class="student-phone-number"></span></p>
                    <p class="description">University Name: <span class="student-university"></span></p>
                    <p class="description">Department: <span class="student-department"></span></p>
                    <p class="description">Bursary Amount: <span class="student-amount"></span></p>
                    <p class="description">Course Of Study: <span class="student-study"></span></p>
                    <p class="description">Hod Name: <span class="hod-name"></span></p>
                    <p class="description">Motivation: <span class="student-motivation"></span></p>
                    <p class="description">Reviewer Comment: <span class="comment"></span></p>
                    <textarea class="review-comment" cols="10" rows="8" placeholder="Please give feedback for the application. Can leave blank" required></textarea>
                  <article .action-buttons >
                    <button class="approve-button">Approve</button>
                    <button class="reject-button">Reject</button>
                  </article>
                    
                </article>
      
              </section>
            </section>
            <section id="university-allocations"  >
              <h1>University Allocations</h2>
            <p id = "admin-remaining-balance"></p>
            <p id = "admin-total-spent"></p>
              <section id="add-new-allocation">
                <article class="header">
                  <img src="../css/images/cancel.png" alt="" id="cancel-icon">
                  <h3>Allocate Funds To An University</h3>
                  <p>Please fill in the form</p>
            
                </article>
            
                <form id="allocation-form">
                  <input
                    type="text"
                    id="university-name"
                    name="universityName"
                    placeholder="University Name"
                  /><br /><br />
                  <input
                    type="text"
                    id="amount"
                    name="amount"
                    placeholder="Amount:"
                  /><br /><br />
            
                  <input
                    type="text"
                    id="bursary-year"
                    name="year"
                    min = "0"
                    placeholder="year"
                  /><br /><br />
            
                  <article class="button-container">
                    <input type="submit" id="allocate-button" value="Submit" />
                  </div>
                </form>
              </section>
            
            <section id="filter-university-allocation">
              <article id="filter-container">
                <button id="add-allocation-button">Add allocation</button>
                <button id="allocate-evenly">Allocate to all approved</button>
                <select id="select-year">
                  <option value="all">All years</option>
                </select>
                <select id="select-university-name">
                  <option value="all-universities">All universities</option>
                </select>
              </article>
            
              <table id="university-allocations-table">
                <thead>
                  <tr>
                    <th>University Name</th>
                    <th>Amount</th>
                    <th>Year</th>
                  </tr>
                </thead>
                <tbody id="allocations-table-body"></tbody>
              </table>
            </section>
            
            
            </section>

    <section id="university_application" >
      <h2>University Applications</h2>
      <section id="filter-university-application">
        <select id="select-university">
          <option value="all">All applications</option>
        </select>
        <article id="add-uviversity">
          <button id="add-university-button">Add new university</button>
        </article>
        <article id="university-application-list">
          <table id="applicationsTable">
            <thead>
              <tr>
                <th>Application ID</th>
                <th>University Name</th>
                <th>Motivation</th>
                <th>Application Status</th>
                <th>Reviewer Comment</th>
              </tr>
            </thead>
            <tbody id="applicationsTableBody"></tbody>
          </table>
        </article>
      </section>

      <section id="university-form">
        <article class="header">
          <img src="../css/images/cancel.png" alt="" id="cancel-icon" />
          <h3>Add New University</h3>
          <p>Please fill in the form</p>
        </article>

        <form id="universityForm" >
          <input
            type="text"
            id="universityName"
            name="universityName"
            required
            placeholder="University Name"
          /><br /><br />
          <input type="submit" value="Submit" id="university-button" />
        </form>
      </section>
    </section>
      </main>



      <script>
        // const fetchData = async function fetchData(url) {
        //   const result = await fetch(url, {
        //     method: "GET",
        //     headers: {
        //       "Content-Type": "application/json",
        //     },
        //   });
        //   return result.json();
        // };
        const allocateEvenlyButton = document.getElementById("allocate-evenly");
        allocateEvenlyButton.addEventListener("click", () => {
      // Display a confirmation dialog
      const confirmAllocation = confirm("Are you sure you want to allocate funds evenly to all?");
  
      if (confirmAllocation) {
          fetch("https://ukukhulaapi.azurewebsites.net/allocations/allocate-to-all", {
              method: "PUT",
              headers: {
                  "Content-Type": "application/json",
              },
          })
          .then((response) => {
              if (response.ok) {
                  alert("Funds allocated evenly");
                  window.location.reload();
              } 
          });
      } else {
          alert("Allocation canceled");
      }
  });
        let data;
        (async () => {
          data = await fetchData("https://ukukhulaapi.azurewebsites.net/allocations/all");
          const applicationsTableBody = document.getElementById(
            "allocations-table-body"
          );
  
          const yearSelect = document.getElementById("select-year");
          const universityNameSelect = document.getElementById(
            "select-university-name"
          );
          addOptionValues(data, yearSelect, "year");
          addOptionValues(data, universityNameSelect, "universityName");
          data.forEach((allocation) => {
            const row = document.createElement("tr");
            row.innerHTML = `
            <td>${allocation.universityName}</td>
            <td>${allocation.amount}</td>
            <td>${allocation.year}</td>
          `;
            applicationsTableBody.appendChild(row);
          });
  
          yearSelect.addEventListener("change", async (event) => {
            const selectedYear = event.target.value;
            if (selectedYear === "all") {
              displayFilteredData(data);
            } else {
              const filteredData = data.filter(
                (allocation) => allocation.year === parseInt(selectedYear)
              );
              displayFilteredData(filteredData);
            }
          });
  
          universityNameSelect.addEventListener("change", async (event) => {
            const selectedUniversityName = event.target.value;
            if (selectedUniversityName === "all-universities") {
              displayFilteredData(data);
            } else {
              const filteredData = data.filter(
                (allocation) =>
                  allocation.universityName === selectedUniversityName
              );
              displayFilteredData(filteredData);
            }
          });
  
          function displayFilteredData(filteredData) {
            const applicationsTableBody = document.getElementById(
              "allocations-table-body"
            );
            applicationsTableBody.innerHTML = "";
  
            filteredData.forEach((allocation) => {
              const row = document.createElement("tr");
              row.innerHTML = `
              <td>${allocation.universityName}</td>
              <td>${allocation.amount}</td>
              <td>${allocation.year}</td>
            `;
              applicationsTableBody.appendChild(row);
            });
          }
        })();
  
        document.addEventListener("DOMContentLoaded", () => {
          const allocationForm = document.getElementById("allocation-form");
  
          allocationForm.addEventListener("submit", async (event) => {
            event.preventDefault();
  
            const formData = new FormData(allocationForm);
            const requestData = {};
  
            formData.forEach((value, key) => {
              requestData[key] = value;
              console.log(requestData);
            });
            try {
              const response = await fetch(
                "https://ukukhulaapi.azurewebsites.net/allocations/addnew",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(requestData),
                }
              );
  
              if (response.ok) {
                alert("Allocation added successfully!");
                location.reload();
              } else {
                throw new Error("Failed to add allocation");
              }
            } catch (error) {
              alert(error);
            }
          });
        });
      </script>
</body>
</html>